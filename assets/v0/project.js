document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".project-player_wrap").forEach(e=>{if(e.dataset.scriptInitialized)return;e.dataset.scriptInitialized="true";const t=e.querySelector(".project-player_stage")||e,n=t.getAttribute("data-project-slug")||e.getAttribute("data-project-slug")||"",o=t.getAttribute("data-video")||e.getAttribute("data-video")||"",r=t.getAttribute("data-captions")||e.getAttribute("data-captions")||"",a=t.getAttribute("data-poster")||e.getAttribute("data-poster")||"",i=t.querySelector(".project-player_video-host")||e.querySelector(".project-player_video-host");if(!i||!o)return;const l=e.querySelector('[data-role="play"]'),d=e.querySelector('[data-role="mute"]'),s=e.querySelector('[data-role="mute-label"]'),c=e.querySelector('[data-role="fs"]'),u=e.querySelector('[data-role="timeline"]'),m=e.querySelector(".project-player_timeline-buffer"),p=e.querySelector(".project-player_timeline-handle");let y=e.querySelector(".project-player_pausefx");if(!y){y=document.createElement("div"),y.className="project-player_pausefx u-cover-absolute u-inset-0";const t=(e.querySelector(".project-player_stage")||e).querySelector(".project-player_video-host"),n=e.querySelector(".project-player_stage")||e;t?.nextSibling?n.insertBefore(y,t.nextSibling):n.appendChild(y)}let h=e.querySelector(".project-player_center-toggle");h||(h=document.createElement("button"),h.className="project-player_center-toggle project-player_btn project-player_btn--play",h.type="button",h.setAttribute("aria-pressed","false"),h.setAttribute("aria-label","Unmute"),h.style.color="#fff",h.innerHTML='<svg viewBox="0 0 24 24" class="pp-icon" aria-hidden="true" fill="none"><g class="pp-icon--group pp-icon--sound"><path d="M12 5V19L7 16H2V8H7L12 5Z"></path><path d="M19.3 19.3C21.0459 17.2685 22.0059 14.6786 22.0059 12C22.0059 9.3214 21.0459 6.73148 19.3 4.70001"></path><path d="M16.4 16.4C17.4429 15.1711 18.0154 13.6118 18.0154 12C18.0154 10.3882 17.4429 8.82888 16.4 7.60001"></path></g><g class="pp-icon--group pp-icon--play"><g class="pp-icon__part pp-icon__play"><path d="M5.2 12V3L13 7.5L20.8 12L13 16.5L5.2 21V12Z"></path></g><g class="pp-icon__part pp-icon__pause"><path d="M9.5 5.5H6.5V18.5H9.5V5.5Z"></path><path d="M17.5 5.5H14.5V18.5H17.5V5.5Z"></path></g></g></svg><span class="u-sr-only">Unmute</span>',(e.querySelector(".project-player_stage")||e).appendChild(h));let v=i.querySelector("video");if(v||(v=document.createElement("video"),v.playsInline=!0,v.crossOrigin="anonymous",v.preload="auto",v.src=o),r&&!v.querySelector('track[kind="subtitles"], track[kind="captions"]')){const e=document.createElement("track");e.kind="subtitles",e.label="English",e.srclang="en",e.src=r,e.default=!1,v.appendChild(e)}v.className="project-player_video",v.controls=!1,a&&(v.poster=a),v.isConnected||i.appendChild(v),v.muted=!0,v.setAttribute("muted",""),v.volume=0;let g=0,f=!1,b=0,S=!1;const E=e=>{const t=e?"true":"false";l&&(l.setAttribute("aria-pressed",t),l.classList.toggle("is-playing",e)),h&&h.classList.contains("is-mode-play")&&(h.setAttribute("aria-pressed",t),h.classList.toggle("is-playing",e))},L=t=>{d&&(d.setAttribute("aria-pressed",t?"true":"false"),s?s.textContent=t?"Sound":"Mute":d.textContent=t?"Sound":"Mute")},C=t=>{e.classList.toggle("is-paused",!!t)},I=t=>{e.dataset.idle=t?"1":"0"},w=()=>{clearTimeout(b),I(!1),b=setTimeout(()=>I(!0),1800)};function k(e){try{const t=JSON.parse(sessionStorage.getItem("videoIntent")||"null");return t&&(!e||t.slug===e)&&Date.now()-t.t<1e4?t:null}catch{return null}}async function T(e){e.readyState<2&&await new Promise(t=>{const n=()=>t();e.addEventListener("loadeddata",n,{once:!0}),e.addEventListener("canplay",n,{once:!0}),setTimeout(n,2500)});try{"fastSeek"in e?e.fastSeek(0):e.currentTime=Math.max(1e-5,e.currentTime)}catch{}try{e.muted=!0,e.setAttribute("muted","");const t=e.play?.();t?.then&&await t.catch(()=>{})}catch{}await new Promise(e=>{let t=!1,n=setTimeout(()=>{t||(t=!0,e())},700);const o=()=>{t||(t=!0,clearTimeout(n),v.removeEventListener("timeupdate",o),requestAnimationFrame(e))};v.addEventListener("timeupdate",o,{once:!0})})}function P(){if(!isFinite(v.duration))return;const e=v.currentTime/v.duration*100;p&&(p.style.left=e+"%"),u&&u.setAttribute("aria-valuenow",String(Math.round(e))),v.buffered&&v.buffered.length&&m&&(m.style.width=Math.min(100,v.buffered.end(v.buffered.length-1)/v.duration*100)+"%")}function A(){g||(g=requestAnimationFrame(function e(){P(),g=requestAnimationFrame(e)}))}function M(){g&&(cancelAnimationFrame(g),g=0)}function D(e){if(!isFinite(v.duration))return;e=Math.max(0,Math.min(100,e)),v.currentTime=e/100*v.duration,P()}function F(){h.classList.add("is-mode-play"),h.setAttribute("aria-label","Play/Pause");const e=!v.paused;h.classList.toggle("is-playing",e),h.setAttribute("aria-pressed",e?"true":"false")}async function q(){try{if(v.paused){if(v.muted||0===v.volume){v.muted=!1,v.removeAttribute("muted");const e=Number(localStorage.getItem("pp:vol")||1)||1;v.volume=e,L(!1),S=!0}await v.play()}else await v.pause()}catch{}E(!v.paused),C(v.paused),v.paused&&!f?M():A(),w()}l?.addEventListener("click",q),h.addEventListener("click",async()=>{if(!h.classList.contains("is-mode-play")){try{v.muted=!1,v.removeAttribute("muted");const e=Number(localStorage.getItem("pp:vol")||1)||1;v.volume=e;try{"fastSeek"in v?v.fastSeek(0):v.currentTime=0}catch{try{v.currentTime=0}catch{}}await v.play?.(),F(),L(!1),E(!0),C(!1),A(),S=!0}catch{}return void w()}await q()}),d?.addEventListener("click",async()=>{const e=v.muted;if(v.muted=!v.muted,v.muted)v.setAttribute("muted","");else{v.removeAttribute("muted"),0===v.volume&&(v.volume=Number(localStorage.getItem("pp:vol")||1)||1),e&&!S&&(S=!0,(()=>{try{"fastSeek"in v?v.fastSeek(0):v.currentTime=0}catch{try{v.currentTime=0}catch{}}})(),await v.play?.(),E(!0),C(!1),A()),F()}localStorage.setItem("pp:muted",v.muted?"1":"0"),L(v.muted),w()});function R(){if(!c)return;const t=!!document.fullscreenElement&&(document.fullscreenElement===e||e.contains(document.fullscreenElement));c.textContent=t?"Minimise":"Fullscreen",c.setAttribute("aria-label",t?"Exit fullscreen":"Toggle fullscreen")}document.addEventListener("fullscreenchange",R),c?.addEventListener("click",async()=>{try{document.fullscreenElement?await document.exitFullscreen?.():await e.requestFullscreen?.()}catch{}w()}),u&&(u.addEventListener("pointerdown",e=>{f=!0,u.setPointerCapture?.(e.pointerId);const t=u.getBoundingClientRect();D((e.clientX-t.left)/t.width*100),A(),w()}),u.addEventListener("pointermove",e=>{if(!f)return;const t=u.getBoundingClientRect();D((e.clientX-t.left)/t.width*100)}));const H=()=>{f=!1,v.paused&&M()};u&&(u.addEventListener("pointerup",H),u.addEventListener("pointercancel",H),u.addEventListener("keydown",e=>{const t=e.shiftKey?10:5,n=Number(u.getAttribute("aria-valuenow")||0);"ArrowRight"===e.key&&(D(n+t),e.preventDefault()),"ArrowLeft"===e.key&&(D(n-t),e.preventDefault()),v.paused||A()})),["mousemove","pointermove","touchstart","keydown"].forEach(t=>{e.addEventListener(t,w,{passive:!0})}),w(),(async function(){await T(v);try{await v.play()}catch{}E(!v.paused),C(v.paused),v.paused||A();const t=k(n);if(t&&t.withSound)try{v.muted=!1,v.removeAttribute("muted"),v.volume=Number(localStorage.getItem("pp:vol")||1)||1,await v.play?.(),L(!1),S=!0,C(!1),F(),A()}catch{L(!0)}else h.classList.remove("is-mode-play"),h.setAttribute("aria-label","Unmute"),L(!0);requestAnimationFrame(()=>requestAnimationFrame(()=>P())),R()})(),v.addEventListener("play",()=>{E(!0),C(!1),A()}),v.addEventListener("playing",()=>{C(!1),A()}),v.addEventListener("pause",()=>{E(!1),C(!0),f||M()}),v.addEventListener("ended",()=>{E(!1),C(!0),f||M()}),v.addEventListener("timeupdate",()=>{f||P()});const N=new MutationObserver(()=>{document.body.contains(e)||(M(),(()=>{try{v.pause(),v.muted=!0}catch{}})(),N.disconnect())});N.observe(document.body,{childList:!0,subtree:!0})})});
